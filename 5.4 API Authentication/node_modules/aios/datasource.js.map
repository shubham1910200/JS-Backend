{"version":3,"sources":["../../../src/datasource.ts"],"names":[],"mappings":"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","file":"datasource.js","sourcesContent":["import {inherits} from 'util';\nimport * as _ from 'lodash';\n\nconst dataSourceTypes = {};\n\nexport function DataSource(server: any, options: any) {\n  options = options || {};\n\n  this.options = options;\n  this.dsn = options.name;\n  this.type = options.type;\n  this.server = server;\n\n}\n\n// @ts-ignore\nDataSource.get = function (type: any) {\n  return dataSourceTypes[type];\n};\n\nDataSource.prototype.getId = function () {\n  return this.options.id;\n};\n\nDataSource.prototype.getName = function () {\n  return this.dsn;\n};\n\nDataSource.prototype.getType = function () {\n  return this.type;\n};\n\nDataSource.prototype.register = function (fn: any) {\n  const self = this;\n  if (fn && _.isFunction(fn)) {\n    this.server.command('ds', {method: 'register', spec: self.options}, function (err: any, response: any) {\n      self.options = _.merge(self.options, response.spec);\n      fn(err, self);\n    });\n  } else {\n    const response = this.server.command('ds', {method: 'register', spec: self.options}, fn);\n    this.options = _.merge(this.options, response.spec);\n    return this;\n  }\n\n};\n\nDataSource.prototype.unregister = function () {\n};\nDataSource.prototype.query = function (query: any) {\n};\nDataSource.prototype.listTables = function () {\n};\nDataSource.prototype.listCatalogs = function () {\n};\nDataSource.prototype.listDatabases = function () {\n};\n\n\nconst JdbcDataSource = function (server: any, options: any) {\n  options = options || {};\n  DataSource.call(this, server, options);\n};\n\ndataSourceTypes['jdbc'] = JdbcDataSource;\n\ninherits(JdbcDataSource, DataSource);\n\n\nJdbcDataSource.prototype.execute = function (sql: any, fn: any) {\n  const data = {\n    dsn: this.getName(),\n    query: {\n      '@t': 'jdbc.q.exec',\n      sql: sql\n    }\n  };\n\n  if (fn && _.isFunction(fn)) {\n    this.server.command('ds.query', data, function (err: any, res: any) {\n      if (res && res.result && res.result['@t']) {\n        delete res.result['@t'];\n      }\n      if (err) {\n        fn(err);\n      } else {\n        fn(null, res.result);\n      }\n    });\n  } else {\n    const response = this.server.command('ds.query', data, fn);\n    delete response.result['@t'];\n    return response.result;\n  }\n};\n\nJdbcDataSource.prototype.select = function (sql: any, fn: any) {\n  return this.query(sql, fn);\n};\n\nJdbcDataSource.prototype.query = function (sql: any, fn: any) {\n  const data = {\n    dsn: this.getName(),\n    query: {\n      '@t': 'jdbc.q.select',\n      sql: sql\n    }\n  };\n\n  if (fn && _.isFunction(fn)) {\n    this.server.command('ds.query', data, function (err: any, res: any) {\n      if (err) {\n        fn(err);\n      } else {\n        fn(null, res.result ? res.result.data : []);\n      }\n    });\n  } else {\n    const response = this.server.command('ds.query', data, fn);\n    return response.result.data;\n  }\n};\n\nJdbcDataSource.prototype.update = function (sql: any, fn: any) {\n  const data = {\n    dsn: this.getName(),\n    query: {\n      '@t': 'jdbc.q.update',\n      sql: sql\n    }\n  };\n\n  if (fn && _.isFunction(fn)) {\n    this.server.command('ds.query', data, function (err: any, res: any) {\n      if (res && res.result && res.result['@t']) {\n        delete res.result['@t'];\n      }\n      if (err) {\n        fn(err);\n      } else {\n        fn(null, res.result);\n      }\n    });\n  } else {\n    const response = this.server.command('ds.query', data, fn);\n    delete response.result['@t'];\n    return response.result;\n  }\n\n};\n\nJdbcDataSource.prototype.executeBatch = function (sqls: any, fn: any) {\n  const data = {\n    dsn: this.getName(),\n    query: {\n      '@t': 'jdbc.q.batch',\n      sqls: sqls\n    }\n  };\n\n  if (fn && _.isFunction(fn)) {\n    this.server.command('ds.query', data, function (err: any, res: any) {\n      if (res && res.result && res.result['@t']) {\n        delete res.result['@t'];\n      }\n      if (err) {\n        fn(err);\n      } else {\n        fn(null, res.result);\n      }\n    });\n  } else {\n    const response = this.server.command('ds.query', data, fn);\n    delete response.result['@t'];\n    return response.result;\n  }\n};\n\nconst _processCatalogResults = function (res: any) {\n  const dbs: any = [];\n\n  if (res && res.result) {\n    if (res.result.catalogs) {\n      res.result.catalogs.forEach(function (x: any) {\n        const db: any = {name: x, schemas: []};\n        dbs.push(db);\n\n        if (res.result.schemas) {\n          res.result.schemas.forEach(function (s: any) {\n            if (s.catalog === x && s.schema) {\n              db.schemas.push(s.schema);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  return dbs;\n};\n\nJdbcDataSource.prototype.listCatalogs = function (fn: any) {\n  const data = {\n    dsn: this.getName(),\n    query: {\n      '@t': 'jdbc.q.schema'\n    }\n  };\n\n  if (fn && _.isFunction(fn)) {\n    this.server.command('ds.query', data, function (err: any, res: any) {\n      const dbs = _processCatalogResults(res);\n      fn(err, dbs);\n    });\n  } else {\n    const response = this.server.command('ds.query', data, fn);\n    return _processCatalogResults(response);\n  }\n\n\n};\n\nJdbcDataSource.prototype.listDatabases = function (fn: any) {\n  return this.listCatalogs(fn);\n};\n\nJdbcDataSource.prototype.listTables = function (selection: any, fn: any) {\n  const data: any = {\n    dsn: this.getName(),\n    query: {\n      '@t': 'jdbc.q.table',\n    }\n  };\n\n  if (_.isString(selection)) {\n    const split = selection.split('.');\n    if (split.length === 2) {\n      data.query.catalog = split[1];\n      data.query.schema = split[0];\n    } else {\n      data.query.catalog = selection;\n    }\n\n    // if dot split\n  } else if (_.isObject(selection)) {\n    data.query = _.merge(data.query, selection);\n  }\n\n\n  // TODO Catalog must be present\n  if (fn && _.isFunction(fn)) {\n    this.server.command('ds.query', data, function (err: any, res: any) {\n      // TODO capture errors\n      if (err) {\n        fn(err);\n      } else {\n        fn(null, res.result.tables);\n      }\n\n    });\n  } else {\n    const response = this.server.command('ds.query', data, fn);\n    return response.result.tables;\n  }\n\n\n};\n\nDataSource.prototype.registerAsync = function () {\n  return new Promise((resolve, reject) => {\n    this.register((err: any, res: any) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(res);\n      }\n    });\n  });\n};\n\n\nJdbcDataSource.prototype.executeAsync = function (sql: any) {\n  return new Promise((resolve, reject) => {\n    this.execute(sql, (err: any, res: any) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(res);\n      }\n    });\n  });\n};\n\nJdbcDataSource.prototype.updateAsync = function (sql: any) {\n  return new Promise((resolve, reject) => {\n    this.update(sql, (err: any, res: any) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(res);\n      }\n    });\n  });\n};\n\n\nJdbcDataSource.prototype.queryAsync = function (sql: any) {\n  return new Promise((resolve, reject) => {\n    this.query(sql, (err: any, res: any) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(res);\n      }\n    });\n  });\n};\n\n\nJdbcDataSource.prototype.selectAsync = function (sql: any) {\n  return new Promise((resolve, reject) => {\n    this.select(sql, (err: any, res: any) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(res);\n      }\n    });\n  });\n};\n\nJdbcDataSource.prototype.listCatalogsAsync = function () {\n  return new Promise((resolve, reject) => {\n    this.listCatalogs((err: any, res: any) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(res);\n      }\n    });\n  });\n};\n\n\nJdbcDataSource.prototype.listTablesAsync = function (selection: any) {\n  return new Promise((resolve, reject) => {\n    this.listTables(selection, (err: any, res: any) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(res);\n      }\n    });\n  });\n};\n\n"],"sourceRoot":"."}